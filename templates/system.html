<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{{ user.name }} | Tarefas</title>
    <!-- Adicione o link para o CDN do Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- ... outros metadados ... -->
    <link href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

</head>
<body class="bg-gray-100">
    <!-- Barra de navegação -->
    <nav class="bg-blue-500 p-4 text-white">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-semibold">Seja bem vindo(a), {{ user.name.title() }}!</h1>
            <a href="{{ url_for('logout') }}" class="bg-white text-blue-500 font-semibold py-2 px-4 rounded border border-white hover:bg-blue-100">
                Sair
            </a>
        </div>
    </nav>

    <div class="container mx-auto mt-8">

        <!-- Botão de criação tarefas -->
        <div class="flex justify-between mb-4 mt-6">
            <h2 class="text-3xl font-semibold mb-4">Suas Tarefas</h2>
            <button id="nova_tarefa" class="bg-green-500 text-white font-semibold py-2 px-4 rounded hover:bg-green-600 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>          
                Nova Tarefa
            </button>
        </div>

        <!-- Lista de Tarefas -->
        <div class="bg-white p-4 rounded shadow-md">
            {% if user.tasks %}
                {% for task in user.tasks %}
                <div class="flex items-center justify-between border-b-2 py-2">
                    <div class="flex-grow">
                        <div class="text-left">
                            <span class="text-xl font-semibold">{{ task.title }}</span>
                            <br>
                            <span class="text-lg">{{ task.description }}</span>
                        </div>
                    </div>
                    <div>
                        Status:
                        <span class="text-sm {% if task.completed %}text-green-500{% else %}text-red-500{% endif %}">
                            {% if task.completed %}Concluída{% else %}Pendente{% endif %}
                        </span>
                        <br>
                        <span class="text-sm">Prazo: {{ task.due.strftime('%d/%m/%Y %H:%M') }}</span>
                        <br>
                        <span class="text-lg">
                            <p class="text-sm">(Criada em {{ task.created_at.strftime('%d/%m/%Y %H:%M') }})</p>
                        </span> 
                        <button onclick="abrirModalConfirmacao('{{ url_for('remove_task', task_id=task.id) }}');" class="bg-red-500 text-white font-semibold py-2 px-2 rounded hover:bg-red-600">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 inline-block align-middle">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                            </svg> 
                        </button>                                        
                        <button class="bg-yellow-500 text-white font-semibold py-2 px-2 rounded hover:bg-yellow-600">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 inline-block align-middle"">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                            </svg>                          
                        </button>
                        <button class="bg-green-500 text-white font-semibold py-2 px-2 rounded hover:bg-green-600">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 inline-block align-middle"">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                            </svg>                          
                        </button>
                    </div>
                </div>            
                {% endfor %}
            {% else %}
                <span>
                    <h2 class="text-xl font-semibold mb-4 text-gray-400 text-center">Você não tem nenhuma tarefa.</h2>
                </span>
            {% endif %}
        </div>
    </div>
    <!-- Modal de Confirmação -->
    <div id="modal_confirmacao" class="fixed top-0 left-0 w-full h-full bg-gray-800 bg-opacity-50 hidden">
        <div class="flex h-full items-center justify-center">
            <div class="bg-white p-8 rounded-lg">
                <p class="text-2xl mb-4">Tem certeza de que deseja excluir esta tarefa?</p>
                <div class="flex justify-end">
                    <button id="confirmar_exclusao" class="w-full bg-red-500 hover:bg-red-700 text-white font-bold py-3 rounded-md transition duration-300">Excluir</button>
                    <button id="cancelar_exclusao" class="w-full bg-gray-500 hover:bg-gray-700 text-white font-bold py-3 rounded-md ml-4 transition duration-300">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal de nova tarefa -->
    <div id="modal_nova_tarefa" class="fixed top-0 left-0 w-full h-full bg-gray-800 bg-opacity-50 hidden">
        <div class="flex h-full items-center justify-center">
            <div class="bg-white p-8 rounded-lg">
                <form action="{{ url_for('new_task') }}" method="post">
                    <h2 class="text-2xl mb-4">Tarefa</h2>
                    <!-- Título da Tarefa -->
                    <div class="mb-4">
                        <label for="task_title" class="block text-gray-700 font-bold mb-2">Título</label>
                        <input type="text" id="task_title" name="task_title" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:border-red-700">
                    </div>
                    
                    <!-- Descrição da Tarefa -->
                    <div class="mb-4">
                        <label for="task_description" class="block text-gray-700 font-bold mb-2">Descrição</label>
                        <input type="text" id="task_description" name="task_description" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:border-red-700">
                    </div>
                    
                    <h2 class="text-2xl mb-4">Prazo</h2>
                    
                    <!-- Divisão em duas colunas para Data e Hora -->
                    <div class="mb-4 flex">
                        <!-- Primeira coluna - Data -->
                        <div class="mr-2 flex-1">
                            <label for="task_due_date" class="block text-gray-700 font-bold mb-2">Data</label>
                            <input type="text" name="task_due_date" id="task_due_date" class="border rounded px-2 py-2 focus:outline-none focus:border-blue-500" readonly>
                        </div>
                        
                        <!-- Segunda coluna - Hora -->
                        <div class="ml-2 flex-1">
                            <label for="task_due_time" class="block text-gray-700 font-bold mb-2">Hora</label>
                            <input type="time" name="task_due_time" id="task_due_time" class="border rounded px-2 focus:outline-none focus:border-blue-500">
                        </div>
                    </div>
                    
                    <!-- Botão de Submit -->
                    <button type="submit" class="w-full bg-green-500 hover:bg-green-700 text-white font-bold py-3 mt-6 rounded-md transition duration-300">Criar Tarefa</button>
                </form>
                
                <!-- Botão de Cancelar -->
                <button class="w-full bg-red-500 hover:bg-red-700 text-white font-bold py-3 rounded-md mt-4 transition duration-300" id="fechar_modal_btn">Cancelar</button>
            </div>
        </div>               
    </div>
    <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.js"></script>
    <script>
        const diasDaSemana = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
        const meses = [
            'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
            'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
        ];

        const picker = new Pikaday({
            field: document.getElementById('task_due_date'),
            format: 'DD/MM/YYYY',
            i18n: {
                previousMonth: 'Mês Anterior',
                nextMonth: 'Próximo Mês',
                months: meses,
                weekdays: diasDaSemana,
                weekdaysShort: diasDaSemana.map(dia => dia.slice(0, 3)),
            },
            onSelect: function(date) {
                const formattedDate = moment(date).format('DD/MM/YYYY');
                this.field.value = formattedDate;
            }
        });
    </script>
    <script>
        const nova_tarefa_btn = document.getElementById('nova_tarefa');
        const fechar_modal_nova_tarefa = document.getElementById('fechar_modal_btn');
        const modal_nova_tarefa = document.getElementById('modal_nova_tarefa');

        nova_tarefa_btn.addEventListener('click', function() {
            modal_nova_tarefa.classList.remove('hidden');
        });

        fechar_modal_nova_tarefa.addEventListener('click', function() {
            modal_nova_tarefa.classList.add('hidden');
        });
    </script>
    <script>
        function abrirModalConfirmacao(url) {
            const modalConfirmacao = document.getElementById('modal_confirmacao');
            const confirmarExclusaoBtn = document.getElementById('confirmar_exclusao');
            const cancelarExclusaoBtn = document.getElementById('cancelar_exclusao');
    
            confirmarExclusaoBtn.onclick = function() {
                window.location.href = url;
            };
    
            cancelarExclusaoBtn.onclick = function() {
                modalConfirmacao.classList.add('hidden');
            };
    
            modalConfirmacao.classList.remove('hidden');
        }
    </script>    
</body>

</html>
